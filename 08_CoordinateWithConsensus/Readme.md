# 7章 サーバ間のサービスディスカバリー


serfによるサービスディスカバリの流れ  
1. 各サーバにserfノードを作成する
2. 各serfノードに他のserfノードからのコネクションをリッスンして受け付けるアドレスを設定
3. 各serfノードに他のserfノードのアドレスを設定し、クラスタに参加
4. ノードがクラスタに参加したり、クラスタ内のノードが機能しなくなった時などにはserfのクラスタディスカバリのイベントを処理


テストコードの解説
1. setUpMemberを実行すると、新しいノードを作成する
2. アドレスとポートを確認し、ハンドラのモックとconfigをわたし、新しいメンバーを作成する
3. その中でクラスタのjoinが行われる
4. leaveを実施して、減ったことを確認する
5. 上記はchannelによる非同期で行われる
6. 追加、削除だったりするイベントはserfがよしなにやってくれる。

replicatorの解説
サーバがクラスタに参加すると、そのコンポーネントは新たに参加したサーバに接続し、そのサーバからデータを読み出してローカルサーバに保存する処理をループで実行する
