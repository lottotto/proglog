# chapter03 ログパッケージの作成

## log パッケージのテストについて

### `TestStoreAppendRead`の流れ
1. 一時ファイル(`store_append_read_test`)を作成する
2. testAppendメソッドで一時ファイルに書き込む
3. testReadメソッドで、s.Readメソッドを利用して書き込んだファイルの中身を読み込む
4. testReadAtメソッドで、s.ReadAtメソッドを利用して書き込んだファイルの中身を読み込む
5. ストアを再作成し、その状態でも読み込めるかをテストする


## レコードの形式
まずはサイズ数を示すレコードが入っていて、その後にそのサイズ数が示すレコードそのものが入っている。詳しくはappendメソッドを確認

#### `testAppend`メソッドについて
1. s.Append()を実行し、n(書き込まれたバイト数)、pos(ストアがファイル内でレコードを持つ位置≒ファイルに書き込まれる前のバイトの位置)、errorを戻す
2. pos+n(=書かれたバイト数)とwidth×i(=Halloworldとレコード長さを格納するためのバイト数（append1回で書き込まれるバイト数×繰り返し回数）)を比較する。

#### `testRead`メソッドについて
1. s.Read(pos)を実行し、レコードを獲得
2. 読まれたものと書かれたものを比較し、あっていなかったら警告を出す。

参考)`read`メソッドについて  
- 8の長さを持つbyteのスライスを作成する
- `s.ReadAt(size, int64(pos))`で一旦全て読み込む

#### `testReadAt`メソッドについて
1. off=0を初期値としてスタート
2. ReadAtでレコードのサイズ数を読み取る。
3. 読み取ったバイト数と、用意した配列の数を比較し、等しくなければテスト失敗
4. offに先ほど読み取ったバイト数を加える。
5. 取得したレコードのサイズ数をもとに、Byteのスライスを作成し、その分をoffsetから読み取る
6. 書き込みされたレコード自体と、取得されたレコードが一緒かどうかを確認する。
